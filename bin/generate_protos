#!/bin/bash

set -e

if [[ "$OSTYPE" == "darwin"* ]]; then
  SED=gsed
else
  SED=sed
fi

cd "$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )/.."

rm -Rf lib/cosmoverse/proto/

buf generate buf.build/cosmos/cosmos-sdk --path cosmos/bank/v1beta1/bank.proto \
                                         --path cosmos/bank/v1beta1/query.proto \
                                         --path cosmos/base/query/v1beta1/pagination.proto \
                                         --path cosmos/base/v1beta1/coin.proto \
                                         --path cosmos/msg/v1/msg.proto \
                                         --path cosmos/query/v1/query.proto
buf generate buf.build/cosmos/cosmos-proto
buf generate buf.build/cosmos/gogo-proto

find lib/cosmoverse/proto/ -type f -exec $SED -i "s/^require 'cosmos/require 'cosmoverse\/proto\/cosmos/g" {} \;
find lib/cosmoverse/proto/ -type f -exec $SED -i "s/^require 'gogoproto/require 'cosmoverse\/proto\/gogoproto/g" {} \;

bundle exec rubocop -A lib/cosmoverse/proto/
